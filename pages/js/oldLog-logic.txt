const reader = new FileReader()
const separators = [" ",", ", "  ", "  "]
const string = "2014-11-17 12:41:09, Info                  DISM   PID=144 Scratch directory set to 'C:\Users\ADMINI~1\AppData\Local\Temp\'. - CDISMManager::put_ScratchDir"

function separate(str, template) {
    template.forEach((element, i) => {
        j = str.indexOf(element)
        str = str.substring(0, j).trim()+"</td><td>" + str.substring(j+element.length).trim()
    });
    return `<td>${str}</td>`
}


function showFile(inFile) {
    const uploadedFile = inFile.files[0]
    //alert(`File name: ${fileReader.readAsText(uploadedFile)}`);
    reader.readAsText(uploadedFile);

    reader.onload = function() {
      //DEBUGMOMENT
      var log = reader.result
      //DEBUGMOMENT
      var rows = log.split('\n')

      document.forms[0].outerHTML = ""

      let logHTML = ""

      for(const row of rows) {
          logHTML += `<tr>${separate(row, separators)}</tr>`
      }

      var xhr = new XMLHttpRequest();  
      xhr.open('GET', '/log-control');
      xhr.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          var doc = new DOMParser().parseFromString(this.responseText, "text/html"); 
          doc.getElementById("filename").innerHTML = uploadedFile.name
          doc.getElementById("table-output").innerHTML = logHTML
          document.body.innerHTML = doc.body.innerHTML;
        }
      }
      xhr.send(null);
    };
  
    reader.onerror = function() {
      console.log(reader.error);
    };
  


}